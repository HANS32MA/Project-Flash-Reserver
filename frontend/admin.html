<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administrador - ReservaCanchas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/frontend/assets/css/admin.css">
    <link rel="icon" href="/frontend/assets/img/logo.png" type="image/png">
    <script type="module" src="/frontend/assets/js/auth.js"></script>
</head>
<body>
    <!-- Alert Container -->
    <div class="alert-container"></div>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h4>ReservaCanchas</h4>
            <p class="mb-0">Panel de Administración</p>
        </div>
        <ul class="sidebar-menu">
            <li class="active">
                <a href="#dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            </li>
            <li>
                <a href="#reservas"><i class="fas fa-calendar-check"></i> Reservas</a>
            </li>
            <li>
                <a href="#canchas"><i class="fas fa-futbol"></i> Canchas</a>
            </li>
            <li>
                <a href="#usuarios"><i class="fas fa-users"></i> Usuarios</a>
            </li>
            <li>
                <a href="#estadisticas"><i class="fas fa-chart-bar"></i> Estadísticas</a>
            </li>
            <li>
                <a href="#notificaciones"><i class="fas fa-bell"></i> Notificaciones</a>
            </li>
            <li>
                <a href="#configuracion"><i class="fas fa-cog"></i> Configuración</a>
            </li>
            <li>
                <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a>
            </li>
            <li>
                <a href="#perfil"><i class="fas fa-user"></i> Mi Perfil</a>
            </li>
        </ul>
    </div>

    <!-- Navbar -->
    <nav class="navbar-admin">
        <div class="container-fluid">
            <button class="btn btn-sm d-lg-none" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="ms-auto d-flex align-items-center">
                <span class="me-3" id="adminNameDisplay">Administrador</span>
                <img src="/frontend/assets/img/logoAdmin.png" class="rounded-circle" alt="User">
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section">
            <h2 class="mb-4">Dashboard</h2>
            
            <!-- Stats Cards -->
            <div class="row">
                <div class="col-md-4">
                    <div class="stat-card blue">
                        <i class="fas fa-calendar-check"></i>
                        <div class="stat-value" id="todayReservations">0</div>
                        <div>Reservas Hoy</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card green">
                        <i class="fas fa-futbol"></i>
                        <div class="stat-value" id="activeCourts">0</div>
                        <div>Canchas Activas</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card purple">
                        <i class="fas fa-users"></i>
                        <div class="stat-value" id="totalUsers">0</div>
                        <div>Usuarios Registrados</div>
                    </div>
                </div>
            </div>
            
            <!-- Calendar -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">Calendario de Reservas</h5>
                </div>
                <div class="card-body">
                    <div id="calendar"></div>
                </div>
            </div>
            
            <!-- Recent Reservations -->
            <div class="card mt-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Reservas Recientes</h5>
                    <a href="#reservas" class="btn btn-sm btn-primary">Ver Todas</a>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="recentReservationsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Cancha</th>
                                    <th>Usuario</th>
                                    <th>Fecha/Hora</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Filled by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Profile Section -->
        <section id="perfil" class="content-section" style="display: none;">
            <div class="profile-section">
                <h2 class="mb-4">Mi Perfil</h2>
                
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Información Personal</h5>
                            </div>
                            <div class="card-body">
                                <form id="adminProfileForm" class="profile-form">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="adminNombre" class="form-label">Nombre Completo</label>
                                                <input type="text" class="form-control" id="adminNombre" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="adminEmail" class="form-label">Correo Electrónico</label>
                                                <input type="email" class="form-control" id="adminEmail" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="adminTelefono" class="form-label">Teléfono</label>
                                                <input type="tel" class="form-control" id="adminTelefono" required>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                                        <button type="button" class="btn btn-outline-secondary me-md-2" id="cancelAdminEdit">Cancelar</button>
                                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <div class="card mt-4">
                            <div class="card-header">
                                <h5 class="mb-0">Cambiar Contraseña</h5>
                            </div>
                            <div class="card-body">
                                <form id="adminPasswordForm" class="profile-form">
                                    <div class="mb-3">
                                        <label for="adminPasswordActual" class="form-label">Contraseña Actual</label>
                                        <input type="password" class="form-control" id="adminPasswordActual" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="adminPasswordNueva" class="form-label">Nueva Contraseña</label>
                                        <input type="password" class="form-control" id="adminPasswordNueva" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="adminPasswordConfirmar" class="form-label">Confirmar Nueva Contraseña</label>
                                        <input type="password" class="form-control" id="adminPasswordConfirmar" required>
                                    </div>
                                    
                                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                        <button type="submit" class="btn btn-primary">Cambiar Contraseña</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card profile-info-card">
                            <div class="card-header">
                                <h5 class="mb-0">Foto de Perfil</h5>
                            </div>
                            <div class="card-body text-center">
                                <div class="profile-img-container">
                                    <img src="/frontend/assets/img/logo.png" alt="Foto de perfil" id="adminProfileImg">
                                </div>
                                <div class="profile-img-actions">
                                    <button class="btn btn-sm btn-primary" id="changeProfileImg">Cambiar Foto</button>
                                    <button class="btn btn-sm btn-outline-danger" id="removeProfileImg">Eliminar</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mt-4 profile-info-card">
                            <div class="card-header">
                                <h5 class="mb-0">Información de Acceso</h5>
                            </div>
                            <div class="card-body access-info">
                                <p><strong>Rol:</strong> Administrador</p>
                                <p><strong>Último acceso:</strong> <span id="lastAccess"></span></p>
                                <p><strong>IP:</strong> <span id="ipAddress"></span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Reservations Section -->
        <section id="reservas" class="content-section" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Gestión de Reservas</h2>
                <div>
                    <button class="btn btn-primary" id="exportReservationsBtn">Exportar</button>
                    <button class="btn btn-success" id="newReservationBtn">Nueva Reserva</button>
                </div>
            </div>
            
            <div class="card filter-card">
                <div class="card-header">
                    <h5 class="mb-0">Filtrar Reservas</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label">Fecha Desde</label>
                            <input type="date" class="form-control" id="reservationDateFrom">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Fecha Hasta</label>
                            <input type="date" class="form-control" id="reservationDateTo">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Cancha</label>
                            <select class="form-select" id="reservationCourtFilter">
                                <option value="">Todas</option>
                                <!-- Filled by JavaScript -->
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Estado</label>
                            <select class="form-select" id="reservationStatusFilter">
                                <option value="">Todos</option>
                                <option value="pending">Pendiente</option>
                                <option value="confirmed">Confirmada</option>
                                <option value="cancelled">Cancelada</option>
                                <option value="completed">Completada</option>
                            </select>
                        </div>
                    </div>
                    <div class="text-end mt-3">
                        <button class="btn btn-primary" id="applyReservationFilters">Aplicar Filtros</button>
                        <button class="btn btn-secondary" id="clearReservationFilters">Limpiar</button>
                    </div>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="reservationsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Cancha</th>
                                    <th>Usuario</th>
                                    <th>Fecha/Hora</th>
                                    <th>Duración</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Filled by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <nav aria-label="Page navigation" class="mt-4">
                        <ul class="pagination justify-content-center" id="reservationsPagination">
                            <!-- Filled by JavaScript -->
                        </ul>
                    </nav>
                </div>
            </div>
        </section>
        
        <!-- Courts Section -->
        <section id="canchas" class="content-section" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Gestión de Canchas</h2>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCourtModal">
                    <i class="fas fa-plus"></i> Agregar Cancha
                </button>
            </div>
            
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="courtsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Tipo</th>
                                    <th>Superficie</th>
                                    <th>Techada</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Filled by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Users Section -->
        <section id="usuarios" class="content-section" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Gestión de Usuarios</h2>
                <div>
                    <button class="btn btn-primary" id="exportUsersBtn">Exportar</button>
                    <button class="btn btn-success" id="addUserBtn">Agregar Usuario</button>
                </div>
            </div>
            
            <div class="card filter-card">
                <div class="card-header">
                    <h5 class="mb-0">Filtrar Usuarios</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="userNameFilter" placeholder="Buscar por nombre">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Correo</label>
                            <input type="text" class="form-control" id="userEmailFilter" placeholder="Buscar por correo">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Estado</label>
                            <select class="form-select" id="userStatusFilter">
                                <option value="">Todos</option>
                                <option value="active">Activo</option>
                                <option value="blocked">Bloqueado</option>
                            </select>
                        </div>
                    </div>
                    <div class="text-end mt-3">
                        <button class="btn btn-primary" id="applyUserFilters">Buscar</button>
                        <button class="btn btn-secondary" id="clearUserFilters">Limpiar</button>
                    </div>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="usersTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Correo</th>
                                    <th>Teléfono</th>
                                    <th>Reservas</th>
                                    <th>Registro</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Filled by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <nav aria-label="Page navigation" class="mt-4">
                        <ul class="pagination justify-content-center" id="usersPagination">
                            <!-- Filled by JavaScript -->
                        </ul>
                    </nav>
                </div>
            </div>
        </section>
        
        <!-- Statistics Section -->
        <section id="estadisticas" class="content-section" style="display: none;">
            <h2 class="mb-4">Estadísticas</h2>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Reservas por Día (Últimos 7 días)</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="dailyReservationsChart" height="300"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Reservas por Cancha (Este Mes)</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="courtReservationsChart" height="300"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">Exportar Reportes</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Tipo de Reporte</label>
                                <select class="form-select" id="reportType">
                                    <option value="reservations">Reservas</option>
                                    <option value="users">Usuarios</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Fecha Desde</label>
                                <input type="date" class="form-control" id="reportDateFrom">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Fecha Hasta</label>
                                <input type="date" class="form-control" id="reportDateTo">
                            </div>
                        </div>
                    </div>
                    <div class="text-end">
                        <button class="btn btn-primary" id="generateReportBtn">Generar Reporte</button>
                        <button class="btn btn-success" id="exportExcelBtn">Exportar a Excel</button>
                        <button class="btn btn-secondary" id="exportPdfBtn">Exportar a PDF</button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Notifications Section -->
        <section id="notificaciones" class="content-section" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Notificaciones</h2>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#sendNotificationModal">
                    <i class="fas fa-plus"></i> Nueva Notificación
                </button>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Notificaciones Enviadas</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="notificationsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Título</th>
                                    <th>Contenido</th>
                                    <th>Destinatarios</th>
                                    <th>Fecha</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Filled by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <nav aria-label="Page navigation" class="mt-4">
                        <ul class="pagination justify-content-center" id="notificationsPagination">
                            <!-- Filled by JavaScript -->
                        </ul>
                    </nav>
                </div>
            </div>
        </section>
        
        <!-- Settings Section -->
        <section id="configuracion" class="content-section" style="display: none;">
            <h2 class="mb-4">Configuración</h2>
            
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Configuración General</h5>
                </div>
                <div class="card-body">
                    <form id="generalSettingsForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Nombre del Sitio</label>
                                    <input type="text" class="form-control" id="siteName">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Correo de Contacto</label>
                                    <input type="email" class="form-control" id="contactEmail">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Teléfono de Contacto</label>
                                    <input type="tel" class="form-control" id="contactPhone">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Horario de Atención</label>
                                    <input type="text" class="form-control" id="businessHours">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Dirección</label>
                                    <textarea class="form-control" id="businessAddress" rows="3"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="text-end">
                            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">Configuración de Notificaciones</h5>
                </div>
                <div class="card-body">
                    <form id="notificationSettingsForm">
                        <div class="mb-3">
                            <label class="form-label">Notificación de Reserva Confirmada</label>
                            <textarea class="form-control" id="confirmedReservationTemplate" rows="3"></textarea>
                        </div>
                        <div class="text-end">
                            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </div>

<!-- Add Court Modal -->
<div class="modal fade" id="addCourtModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Agregar Nueva Cancha</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addCourtForm" class="modal-form">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Nombre</label>
                                <input type="text" class="form-control" id="courtName" placeholder="Ej: Cancha Fútbol 5" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Tipo</label>
                                <select class="form-select" id="courtType" required>
                                    <option value="">Seleccionar tipo</option>
                                    <option value="futbol11">Fútbol 11</option>
                                    <option value="futbol5">Fútbol 5</option>
                                    <option value="tenis">Tenis</option>
                                    <option value="basquetbol">Básquetbol</option>
                                    <option value="voleibol">Vóleibol</option>
                                    <option value="padel">Pádel</option>
                                    <option value="otro">Otro</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Superficie</label>
                                <select class="form-select" id="courtSurface" required>
                                    <option value="">Seleccionar superficie</option>
                                    <option value="cesped-sintetico">Césped sintético</option>
                                    <option value="arcilla">Arcilla</option>
                                    <option value="concreto">Concreto pulido</option>
                                    <option value="arena">Arena</option>
                                    <option value="cesped-natural">Césped natural</option>
                                    <option value="otro">Otro</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Capacidad</label>
                                <input type="number" class="form-control" id="courtCapacity" placeholder="Número de jugadores" required>
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="coveredCourt">
                                    <label class="form-check-label" for="coveredCourt">Techada</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="lightedCourt" checked>
                                    <label class="form-check-label" for="lightedCourt">Con iluminación</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Estado</label>
                                <select class="form-select" id="courtStatus" required>
                                    <option value="active">Activa</option>
                                    <option value="maintenance">En mantenimiento</option>
                                    <option value="inactive">Inactiva</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Descripción</label>
                        <textarea class="form-control" id="courtDescription" rows="3" placeholder="Descripción detallada de la cancha"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Imágenes</label>
                        <input type="file" class="form-control" id="courtImages" multiple accept="image/*">
                        <div id="newImagesPreview" class="d-flex flex-wrap gap-2 mt-2"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="saveCourtBtn">Guardar Cancha</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Court Modal -->
<div class="modal fade" id="editCourtModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Editar Cancha</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editCourtForm" class="modal-form">
                    <input type="hidden" id="editCourtId">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Nombre</label>
                                <input type="text" class="form-control" id="editCourtName" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Tipo</label>
                                <select class="form-select" id="editCourtType" required>
                                    <option value="futbol11">Fútbol 11</option>
                                    <option value="futbol5">Fútbol 5</option>
                                    <option value="tenis">Tenis</option>
                                    <option value="basquetbol">Básquetbol</option>
                                    <option value="voleibol">Vóleibol</option>
                                    <option value="padel">Pádel</option>
                                    <option value="otro">Otro</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Superficie</label>
                                <select class="form-select" id="editCourtSurface" required>
                                    <option value="cesped-sintetico">Césped sintético</option>
                                    <option value="arcilla">Arcilla</option>
                                    <option value="concreto">Concreto pulido</option>
                                    <option value="arena">Arena</option>
                                    <option value="cesped-natural">Césped natural</option>
                                    <option value="otro">Otro</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Capacidad</label>
                                <input type="number" class="form-control" id="editCourtCapacity" required>
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="editCoveredCourt">
                                    <label class="form-check-label" for="editCoveredCourt">Techada</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="editLightedCourt">
                                    <label class="form-check-label" for="editLightedCourt">Con iluminación</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Estado</label>
                                <select class="form-select" id="editCourtStatus" required>
                                    <option value="active">Activa</option>
                                    <option value="maintenance">En mantenimiento</option>
                                    <option value="inactive">Inactiva</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Descripción</label>
                        <textarea class="form-control" id="editCourtDescription" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Imágenes</label>
                        <input type="file" class="form-control" id="editCourtImages" multiple accept="image/*">
                        <div id="editImagesPreview" class="d-flex flex-wrap gap-2 mt-2"></div>
                        <div id="currentImages" class="d-flex flex-wrap gap-2 mt-2"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="updateCourtBtn">Actualizar Cancha</button>
            </div>
        </div>
    </div>
</div>

    <!-- Send Notification Modal -->
    <div class="modal fade" id="sendNotificationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Enviar Notificación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="sendNotificationForm" class="modal-form">
                        <div class="mb-3">
                            <label class="form-label">Título</label>
                            <input type="text" class="form-control" id="notificationTitle" placeholder="Ej: Mantenimiento Programado" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Contenido</label>
                            <textarea class="form-control" id="notificationContent" rows="4" placeholder="Escribe el mensaje que se enviará a los usuarios" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Destinatarios</label>
                            <select class="form-select" id="notificationRecipients" required>
                                <option value="all">Todos los usuarios</option>
                                <option value="active">Usuarios activos</option>
                                <option value="with-reservations">Usuarios con reservas</option>
                                <option value="specific">Usuarios específicos</option>
                            </select>
                        </div>
                        <div class="mb-3" id="specificUsersContainer" style="display: none;">
                            <label class="form-label">Seleccionar Usuarios</label>
                            <select class="form-select" id="specificUsers" multiple>
                                <!-- Filled by JavaScript -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Tipo</label>
                            <select class="form-select" id="notificationType" required>
                                <option value="general">General</option>
                                <option value="promotion">Promoción</option>
                                <option value="important">Importante</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="sendNotificationBtn">Enviar Notificación</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Notification Modal -->
    <div class="modal fade" id="viewNotificationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewNotificationTitle">Detalles de Notificación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <strong>Contenido:</strong>
                        <p id="viewNotificationContent"></p>
                    </div>
                    <div class="mb-3">
                        <strong>Destinatarios:</strong>
                        <p id="viewNotificationRecipients"></p>
                    </div>
                    <div class="mb-3">
                        <strong>Fecha de envío:</strong>
                        <p id="viewNotificationDate"></p>
                    </div>
                    <div class="mb-3">
                        <strong>Estado:</strong>
                        <p id="viewNotificationStatus"></p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit User Modal -->
    <div class="modal fade" id="userModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="userModalTitle">Agregar Usuario</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="userForm" class="modal-form">
                        <input type="hidden" id="userId">
                        <div class="mb-3">
                            <label class="form-label">Nombre Completo</label>
                            <input type="text" class="form-control" id="userFullName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Correo Electrónico</label>
                            <input type="email" class="form-control" id="userEmail" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Teléfono</label>
                            <input type="tel" class="form-control" id="userPhone" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Contraseña</label>
                            <input type="password" class="form-control" id="userPassword" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Confirmar Contraseña</label>
                            <input type="password" class="form-control" id="userConfirmPassword" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Rol</label>
                            <select class="form-select" id="userRole" required>
                                <option value="user">Usuario</option>
                                <option value="admin">Administrador</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Estado</label>
                            <select class="form-select" id="userStatus" required>
                                <option value="active">Activo</option>
                                <option value="blocked">Bloqueado</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="saveUserBtn">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Reservation Modal -->
    <div class="modal fade" id="reservationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reservationModalTitle">Nueva Reserva</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="reservationForm" class="modal-form">
                        <input type="hidden" id="reservationId">
                        <div class="mb-3">
                            <label class="form-label">Cancha</label>
                            <select class="form-select" id="reservationCourt" required>
                                <!-- Filled by JavaScript -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Usuario</label>
                            <select class="form-select" id="reservationUser" required>
                                <!-- Filled by JavaScript -->
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Fecha</label>
                                    <input type="date" class="form-control" id="reservationDate" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Hora</label>
                                    <input type="time" class="form-control" id="reservationTime" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Duración (horas)</label>
                            <input type="number" class="form-control" id="reservationDuration" min="1" max="4" value="1" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Estado</label>
                            <select class="form-select" id="reservationStatus" required>
                                <option value="pending">Pendiente</option>
                                <option value="confirmed">Confirmada</option>
                                <option value="cancelled">Cancelada</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notas</label>
                            <textarea class="form-control" id="reservationNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="saveReservationBtn">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Reservation Modal -->
    <div class="modal fade" id="viewReservationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Detalles de Reserva</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <strong>ID:</strong>
                        <p id="viewReservationId"></p>
                    </div>
                    <div class="mb-3">
                        <strong>Cancha:</strong>
                        <p id="viewReservationCourt"></p>
                    </div>
                    <div class="mb-3">
                        <strong>Usuario:</strong>
                        <p id="viewReservationUser"></p>
                    </div>
                    <div class="mb-3">
                        <strong>Fecha/Hora:</strong>
                        <p id="viewReservationDateTime"></p>
                    </div>
                    <div class="mb-3">
                        <strong>Duración:</strong>
                        <p id="viewReservationDuration"></p>
                    </div>
                    <div class="mb-3">
                        <strong>Estado:</strong>
                        <p id="viewReservationStatus"></p>
                    </div>
                    <div class="mb-3">
                        <strong>Notas:</strong>
                        <p id="viewReservationNotes"></p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Image Upload Modal -->
    <div class="modal fade" id="profileImageModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cambiar Foto de Perfil</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="profileImageForm">
                        <div class="mb-3">
                            <label for="profileImageInput" class="form-label">Seleccionar imagen</label>
                            <input class="form-control" type="file" id="profileImageInput" accept="image/*">
                        </div>
                        <div class="mb-3">
                            <div id="imagePreviewContainer" style="display: none;">
                                <p class="mb-2">Vista previa:</p>
                                <img id="imagePreview" class="img-fluid rounded" style="max-height: 200px;">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="saveProfileImage">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal fade" id="confirmationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmationModalTitle">Confirmación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="confirmationModalBody">
                    ¿Está seguro que desea realizar esta acción?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirmActionBtn">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the application
            function initApp() {
                // Initialize UI components
                initSidebar();
                initCalendar();
                initCharts();
                setupEventListeners();
                
                // Load initial data
                loadDashboardStats();
                loadRecentReservations();
                loadReservations();
                loadCourts();
                loadUsers();
                loadNotifications();
                loadSettings();
                loadAdminProfile();
            }

            // Initialize sidebar functionality
            function initSidebar() {
                // Sidebar toggle for mobile
                document.getElementById('sidebarToggle').addEventListener('click', function() {
                    document.querySelector('.sidebar').classList.toggle('active');
                });
                
                // Navigation between sections
                const navLinks = document.querySelectorAll('.sidebar-menu li a');
                const sections = document.querySelectorAll('.content-section');
                
                navLinks.forEach(link => {
                    if (link.getAttribute('href') !== '#') {
                        link.addEventListener('click', function(e) {
                            e.preventDefault();
                            
                            // Remove active class from all links and sections
                            navLinks.forEach(navLink => navLink.parentElement.classList.remove('active'));
                            sections.forEach(section => section.style.display = 'none');
                            
                            // Add active class to clicked link
                            this.parentElement.classList.add('active');
                            
                            // Show corresponding section
                            const sectionId = this.getAttribute('href');
                            document.querySelector(sectionId).style.display = 'block';
                        });
                    }
                });

                // Logout button
                document.getElementById('logoutBtn').addEventListener('click', function(e) {
                    e.preventDefault();
                    showConfirmationModal('Cerrar Sesión', '¿Está seguro que desea cerrar sesión?', function() {
                        // Redirect to logout endpoint
                        window.location.href = 'index.html';
                    });
                });
            }

            // Initialize FullCalendar
            function initCalendar() {
                const calendarEl = document.getElementById('calendar');
                const calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay'
                    },
                    events: function(fetchInfo, successCallback, failureCallback) {
                        // Fetch reservations from API
                        fetch('/api/reservations')
                            .then(response => response.json())
                            .then(data => {
                                const events = data.map(reservation => {
                                    const startDateTime = `${reservation.date}T${reservation.time}:00`;
                                    
                                    // Calculate end time
                                    const [hours, minutes] = reservation.time.split(':').map(Number);
                                    const durationHours = Math.floor(reservation.duration);
                                    const durationMinutes = Math.floor((reservation.duration % 1) * 60);
                                    const endDate = new Date(startDateTime);
                                    endDate.setHours(endDate.getHours() + durationHours);
                                    endDate.setMinutes(endDate.getMinutes() + durationMinutes);
                                    
                                    // Format end time
                                    const endTime = `${endDate.getHours().toString().padStart(2, '0')}:${endDate.getMinutes().toString().padStart(2, '0')}`;
                                    const endDateTime = `${reservation.date}T${endTime}:00`;
                                    
                                    return {
                                        title: `Reserva: ${reservation.court.name} (${reservation.user.name})`,
                                        start: startDateTime,
                                        end: endDateTime,
                                        backgroundColor: getStatusColor(reservation.status),
                                        extendedProps: {
                                            reservationId: reservation.id
                                        }
                                    };
                                });
                                successCallback(events);
                            })
                            .catch(error => {
                                console.error('Error fetching reservations:', error);
                                failureCallback(error);
                            });
                    },
                    eventClick: function(info) {
                        const reservationId = info.event.extendedProps.reservationId;
                        viewReservation(reservationId);
                    }
                });
                calendar.render();
            }

            // Initialize charts
            function initCharts() {
                // Daily Reservations Chart
                const dailyReservationsCtx = document.getElementById('dailyReservationsChart').getContext('2d');
                const dailyReservationsChart = new Chart(dailyReservationsCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'],
                        datasets: [{
                            label: 'Reservas por Día',
                            data: [0, 0, 0, 0, 0, 0, 0],
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                            borderColor: 'rgba(52, 152, 219, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
                
                // Court Reservations Chart
                const courtReservationsCtx = document.getElementById('courtReservationsChart').getContext('2d');
                const courtReservationsChart = new Chart(courtReservationsCtx, {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                'rgba(52, 152, 219, 0.7)',
                                'rgba(46, 204, 113, 0.7)',
                                'rgba(155, 89, 182, 0.7)',
                                'rgba(230, 126, 34, 0.7)',
                                'rgba(231, 76, 60, 0.7)',
                                'rgba(241, 196, 15, 0.7)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'right'
                            }
                        }
                    }
                });
            }

            // Load admin profile data
            function loadAdminProfile() {
                fetch('/api/admin/profile')
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('adminNombre').value = data.name;
                        document.getElementById('adminEmail').value = data.email;
                        document.getElementById('adminTelefono').value = data.phone;
                        document.getElementById('adminProfileImg').src = data.profileImage || '/frontend/assets/img/logo.png';
                        document.getElementById('lastAccess').textContent = data.lastAccess;
                        document.getElementById('ipAddress').textContent = data.ip;
                        document.getElementById('adminNameDisplay').textContent = data.name;
                    })
                    .catch(error => {
                        console.error('Error loading admin profile:', error);
                        showAlert('Error al cargar el perfil del administrador', 'error');
                    });
            }

            // Load dashboard statistics
            function loadDashboardStats() {
                fetch('/api/dashboard/stats')
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('todayReservations').textContent = data.todayReservations;
                        document.getElementById('activeCourts').textContent = data.activeCourts;
                        document.getElementById('totalUsers').textContent = data.totalUsers;
                    })
                    .catch(error => {
                        console.error('Error loading dashboard stats:', error);
                        showAlert('Error al cargar estadísticas del dashboard', 'error');
                    });
            }

            // Load recent reservations for dashboard
            function loadRecentReservations() {
                fetch('/api/reservations/recent')
                    .then(response => response.json())
                    .then(data => {
                        const tbody = document.querySelector('#recentReservationsTable tbody');
                        tbody.innerHTML = '';
                        
                        data.forEach(reservation => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>#${reservation.id}</td>
                                <td>${reservation.court.name}</td>
                                <td>${reservation.user.name}</td>
                                <td>${formatDate(reservation.date)} ${reservation.time}</td>
                                <td><span class="badge ${getStatusBadgeClass(reservation.status)}">${getStatusText(reservation.status)}</span></td>
                                <td class="table-actions">
                                    <button class="btn btn-sm btn-primary" data-id="${reservation.id}" data-action="view">Ver</button>
                                    ${reservation.status === 'pending' ? 
                                        `<button class="btn btn-sm btn-success" data-id="${reservation.id}" data-action="confirm">Confirmar</button>` : 
                                        `<button class="btn btn-sm btn-danger" data-id="${reservation.id}" data-action="cancel">Cancelar</button>`}
                                </td>
                            `;
                            tbody.appendChild(row);
                        });
                    })
                    .catch(error => {
                        console.error('Error loading recent reservations:', error);
                        showAlert('Error al cargar reservas recientes', 'error');
                    });
            }

            // Load reservations with pagination
            function loadReservations(page = 1, filters = {}) {
                const queryParams = new URLSearchParams({
                    page: page,
                    ...filters
                });
                
                fetch(`/api/reservations?${queryParams}`)
                    .then(response => response.json())
                    .then(data => {
                        const tbody = document.querySelector('#reservationsTable tbody');
                        tbody.innerHTML = '';
                        
                        data.reservations.forEach(reservation => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>#${reservation.id}</td>
                                <td>${reservation.court.name}</td>
                                <td>${reservation.user.name}</td>
                                <td>${formatDate(reservation.date)} ${reservation.time}</td>
                                <td>${reservation.duration} horas</td>
                                <td><span class="badge ${getStatusBadgeClass(reservation.status)}">${getStatusText(reservation.status)}</span></td>
                                <td class="table-actions">
                                    <button class="btn btn-sm btn-primary" data-id="${reservation.id}" data-action="view">Ver</button>
                                    ${reservation.status === 'pending' ? 
                                        `<button class="btn btn-sm btn-success" data-id="${reservation.id}" data-action="confirm">Confirmar</button>` : ''}
                                    ${reservation.status !== 'cancelled' && reservation.status !== 'completed' ? 
                                        `<button class="btn btn-sm btn-danger" data-id="${reservation.id}" data-action="cancel">Cancelar</button>` : ''}
                                    <button class="btn btn-sm btn-secondary" data-id="${reservation.id}" data-action="edit">Editar</button>
                                </td>
                            `;
                            tbody.appendChild(row);
                        });
                        
                        // Update pagination
                        updatePagination('reservationsPagination', data.total, page);
                        
                        // Fill court filter dropdown
                        const courtFilter = document.getElementById('reservationCourtFilter');
                        courtFilter.innerHTML = '<option value="">Todas</option>';
                        data.courts.forEach(court => {
                            const option = document.createElement('option');
                            option.value = court.id;
                            option.textContent = court.name;
                            courtFilter.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error('Error loading reservations:', error);
                        showAlert('Error al cargar reservas', 'error');
                    });
            }

            // Load courts
            function loadCourts() {
                fetch('/api/courts')
                    .then(response => response.json())
                    .then(data => {
                        const tbody = document.querySelector('#courtsTable tbody');
                        tbody.innerHTML = '';
                        
                        data.forEach(court => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${court.id}</td>
                                <td>${court.name}</td>
                                <td>${getCourtTypeText(court.type)}</td>
                                <td>${getSurfaceText(court.surface)}</td>
                                <td>${court.covered ? '<i class="fas fa-check text-success"></i>' : '<i class="fas fa-times text-danger"></i>'}</td>
                                <td><span class="badge ${getStatusBadgeClass(court.status)}">${getStatusText(court.status)}</span></td>
                                <td class="table-actions">
                                    <button class="btn btn-sm btn-primary" data-id="${court.id}" data-action="edit">Editar</button>
                                    <button class="btn btn-sm btn-danger" data-id="${court.id}" data-action="delete">Eliminar</button>
                                </td>
                            `;
                            tbody.appendChild(row);
                        });
                    })
                    .catch(error => {
                        console.error('Error loading courts:', error);
                        showAlert('Error al cargar canchas', 'error');
                    });
            }

            // Load users with pagination
            function loadUsers(page = 1, filters = {}) {
                const queryParams = new URLSearchParams({
                    page: page,
                    ...filters
                });
                
                fetch(`/api/users?${queryParams}`)
                    .then(response => response.json())
                    .then(data => {
                        const tbody = document.querySelector('#usersTable tbody');
                        tbody.innerHTML = '';
                        
                        data.users.forEach(user => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${user.id}</td>
                                <td>${user.name}</td>
                                <td>${user.email}</td>
                                <td>${user.phone}</td>
                                <td>${user.reservations}</td>
                                <td>${formatDate(user.registrationDate)}</td>
                                <td><span class="badge ${user.status === 'active' ? 'bg-success' : 'bg-danger'}">${user.status === 'active' ? 'Activo' : 'Bloqueado'}</span></td>
                                <td class="table-actions">
                                    <button class="btn btn-sm btn-primary" data-id="${user.id}" data-action="edit">Editar</button>
                                    ${user.status === 'active' ? 
                                        `<button class="btn btn-sm btn-danger" data-id="${user.id}" data-action="block">Bloquear</button>` : 
                                        `<button class="btn btn-sm btn-success" data-id="${user.id}" data-action="activate">Activar</button>`}
                                </td>
                            `;
                            tbody.appendChild(row);
                        });
                        
                        // Update pagination
                        updatePagination('usersPagination', data.total, page);
                    })
                    .catch(error => {
                        console.error('Error loading users:', error);
                        showAlert('Error al cargar usuarios', 'error');
                    });
            }

            // Load notifications with pagination
            function loadNotifications(page = 1) {
                fetch(`/api/notifications?page=${page}`)
                    .then(response => response.json())
                    .then(data => {
                        const tbody = document.querySelector('#notificationsTable tbody');
                        tbody.innerHTML = '';
                        
                        data.notifications.forEach(notification => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${notification.id}</td>
                                <td>${notification.title}</td>
                                <td>${notification.content.length > 50 ? notification.content.substring(0, 50) + '...' : notification.content}</td>
                                <td>${getRecipientsText(notification.recipients)}</td>
                                <td>${formatDate(notification.date)}</td>
                                <td><span class="badge bg-success">Enviada</span></td>
                                <td class="table-actions">
                                    <button class="btn btn-sm btn-primary" data-id="${notification.id}" data-action="view">Ver</button>
                                    <button class="btn btn-sm btn-danger" data-id="${notification.id}" data-action="delete">Eliminar</button>
                                </td>
                            `;
                            tbody.appendChild(row);
                        });
                        
                        // Update pagination
                        updatePagination('notificationsPagination', data.total, page);
                        
                        // Fill specific users dropdown
                        const specificUsersSelect = document.getElementById('specificUsers');
                        specificUsersSelect.innerHTML = '';
                        data.users.forEach(user => {
                            const option = document.createElement('option');
                            option.value = user.id;
                            option.textContent = user.name;
                            specificUsersSelect.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error('Error loading notifications:', error);
                        showAlert('Error al cargar notificaciones', 'error');
                    });
            }

            // Load settings
            function loadSettings() {
                fetch('/api/settings')
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('siteName').value = data.siteName;
                        document.getElementById('contactEmail').value = data.contactEmail;
                        document.getElementById('contactPhone').value = data.contactPhone;
                        document.getElementById('businessHours').value = data.businessHours;
                        document.getElementById('businessAddress').value = data.businessAddress;
                        document.getElementById('confirmedReservationTemplate').value = data.confirmedReservationTemplate;
                    })
                    .catch(error => {
                        console.error('Error loading settings:', error);
                        showAlert('Error al cargar configuración', 'error');
                    });
            }

            // Update pagination controls
            function updatePagination(elementId, totalItems, currentPage) {
                const totalPages = Math.ceil(totalItems / itemsPerPage);
                const pagination = document.getElementById(elementId);
                pagination.innerHTML = '';
                
                // Previous button
                const prevLi = document.createElement('li');
                prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
                prevLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage - 1}">Anterior</a>`;
                pagination.appendChild(prevLi);
                
                // Page numbers
                for (let i = 1; i <= totalPages; i++) {
                    const pageLi = document.createElement('li');
                    pageLi.className = `page-item ${i === currentPage ? 'active' : ''}`;
                    pageLi.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
                    pagination.appendChild(pageLi);
                }
                
                // Next button
                const nextLi = document.createElement('li');
                nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
                nextLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage + 1}">Siguiente</a>`;
                pagination.appendChild(nextLi);
            }

            // Setup event listeners
            function setupEventListeners() {
                // Profile form submission
                document.getElementById('adminProfileForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Validate fields
                    const nombre = document.getElementById('adminNombre').value;
                    const email = document.getElementById('adminEmail').value;
                    const telefono = document.getElementById('adminTelefono').value;
                    
                    if (!nombre || !email || !telefono) {
                        showAlert('Por favor complete todos los campos obligatorios', 'error');
                        return;
                    }
                    
                    if (!validarEmail(email)) {
                        showAlert('Por favor ingrese un correo electrónico válido', 'error');
                        return;
                    }
                    
                    // Update admin data
                    fetch('/api/admin/profile', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            name: nombre,
                            email: email,
                            phone: telefono
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Update name in navbar
                            document.getElementById('adminNameDisplay').textContent = nombre;
                            showAlert('Información personal actualizada con éxito', 'success');
                        } else {
                            showAlert(data.message || 'Error al actualizar el perfil', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error updating profile:', error);
                        showAlert('Error al actualizar el perfil', 'error');
                    });
                });

                // Cancel profile edit
                document.getElementById('cancelAdminEdit').addEventListener('click', function() {
                    loadAdminProfile();
                    showAlert('Cambios descartados', 'info');
                });

                // Password form submission
                document.getElementById('adminPasswordForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    const actual = document.getElementById('adminPasswordActual').value;
                    const nueva = document.getElementById('adminPasswordNueva').value;
                    const confirmar = document.getElementById('adminPasswordConfirmar').value;
                    
                    if (!actual || !nueva || !confirmar) {
                        showAlert('Por favor complete todos los campos', 'error');
                        return;
                    }
                    
                    if (nueva !== confirmar) {
                        showAlert('Las contraseñas no coinciden', 'error');
                        return;
                    }
                    
                    if (nueva.length < 6) {
                        showAlert('La contraseña debe tener al menos 6 caracteres', 'error');
                        return;
                    }
                    
                    // Update password
                    fetch('/api/admin/password', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            currentPassword: actual,
                            newPassword: nueva
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showAlert('Contraseña cambiada con éxito', 'success');
                            this.reset();
                        } else {
                            showAlert(data.message || 'Error al cambiar la contraseña', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error changing password:', error);
                        showAlert('Error al cambiar la contraseña', 'error');
                    });
                });

                // Profile image handling
                const profileImageModal = new bootstrap.Modal(document.getElementById('profileImageModal'));
                
                // Change profile image button
                document.getElementById('changeProfileImg').addEventListener('click', function() {
                    profileImageModal.show();
                });
                
                // Remove profile image button
                document.getElementById('removeProfileImg').addEventListener('click', function() {
                    showConfirmationModal('Eliminar Foto', '¿Está seguro que desea eliminar su foto de perfil?', function() {
                        fetch('/api/admin/profile/image', {
                            method: 'DELETE'
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                document.getElementById('adminProfileImg').src = '/frontend/assets/img/logo.png';
                                showAlert('Foto de perfil eliminada', 'success');
                            } else {
                                showAlert(data.message || 'Error al eliminar la foto de perfil', 'error');
                            }
                        })
                        .catch(error => {
                            console.error('Error removing profile image:', error);
                            showAlert('Error al eliminar la foto de perfil', 'error');
                        });
                    });
                });
                
                // Save profile image
                document.getElementById('saveProfileImage').addEventListener('click', function() {
                    const input = document.getElementById('profileImageInput');
                    if (input.files && input.files[0]) {
                        const formData = new FormData();
                        formData.append('image', input.files[0]);
                        
                        fetch('/api/admin/profile/image', {
                            method: 'POST',
                            body: formData
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                document.getElementById('adminProfileImg').src = data.imageUrl;
                                profileImageModal.hide();
                                showAlert('Foto de perfil actualizada', 'success');
                            } else {
                                showAlert(data.message || 'Error al actualizar la foto de perfil', 'error');
                            }
                        })
                        .catch(error => {
                            console.error('Error updating profile image:', error);
                            showAlert('Error al actualizar la foto de perfil', 'error');
                        });
                    } else {
                        showAlert('Por favor seleccione una imagen', 'error');
                    }
                });

                // Reservations filters
                document.getElementById('applyReservationFilters').addEventListener('click', function() {
                    const filters = {
                        dateFrom: document.getElementById('reservationDateFrom').value,
                        dateTo: document.getElementById('reservationDateTo').value,
                        courtId: document.getElementById('reservationCourtFilter').value,
                        status: document.getElementById('reservationStatusFilter').value
                    };
                    loadReservations(1, filters);
                });

                document.getElementById('clearReservationFilters').addEventListener('click', function() {
                    document.getElementById('reservationDateFrom').value = '';
                    document.getElementById('reservationDateTo').value = '';
                    document.getElementById('reservationCourtFilter').value = '';
                    document.getElementById('reservationStatusFilter').value = '';
                    loadReservations(1);
                });

                // Users filters
                document.getElementById('applyUserFilters').addEventListener('click', function() {
                    const filters = {
                        name: document.getElementById('userNameFilter').value,
                        email: document.getElementById('userEmailFilter').value,
                        status: document.getElementById('userStatusFilter').value
                    };
                    loadUsers(1, filters);
                });

                document.getElementById('clearUserFilters').addEventListener('click', function() {
                    document.getElementById('userNameFilter').value = '';
                    document.getElementById('userEmailFilter').value = '';
                    document.getElementById('userStatusFilter').value = '';
                    loadUsers(1);
                });

                // Pagination click handlers
                document.addEventListener('click', function(e) {
                    if (e.target.classList.contains('page-link')) {
                        e.preventDefault();
                        const page = parseInt(e.target.getAttribute('data-page'));
                        const paginationId = e.target.closest('.pagination').id;
                        
                        if (paginationId === 'reservationsPagination') {
                            loadReservations(page);
                        } else if (paginationId === 'usersPagination') {
                            loadUsers(page);
                        } else if (paginationId === 'notificationsPagination') {
                            loadNotifications(page);
                        }
                    }
                });

                // Table action buttons
                document.addEventListener('click', function(e) {
                    if (e.target.tagName === 'BUTTON' && e.target.hasAttribute('data-action')) {
                        const action = e.target.getAttribute('data-action');
                        const id = parseInt(e.target.getAttribute('data-id'));
                        
                        if (e.target.closest('#recentReservationsTable') || e.target.closest('#reservationsTable')) {
                            handleReservationAction(action, id);
                        } else if (e.target.closest('#courtsTable')) {
                            handleCourtAction(action, id);
                        } else if (e.target.closest('#usersTable')) {
                            handleUserAction(action, id);
                        } else if (e.target.closest('#notificationsTable')) {
                            handleNotificationAction(action, id);
                        }
                    }
                });

                // New reservation button
                document.getElementById('newReservationBtn').addEventListener('click', function() {
                    openReservationModal();
                });

                // Add user button
                document.getElementById('addUserBtn').addEventListener('click', function() {
                    openUserModal();
                });

                // Export buttons
                document.getElementById('exportReservationsBtn').addEventListener('click', function() {
                    showAlert('Exportando datos de reservas...', 'info');
                    // Implement export functionality here
                });

                document.getElementById('exportUsersBtn').addEventListener('click', function() {
                    showAlert('Exportando datos de usuarios...', 'info');
                    // Implement export functionality here
                });

                // Report generation
                document.getElementById('generateReportBtn').addEventListener('click', function() {
                    showAlert('Generando reporte...', 'info');
                    // Implement report generation here
                });

                document.getElementById('exportExcelBtn').addEventListener('click', function() {
                    showAlert('Exportando a Excel...', 'info');
                    // Implement Excel export here
                });

                document.getElementById('exportPdfBtn').addEventListener('click', function() {
                    showAlert('Exportando a PDF...', 'info');
                    // Implement PDF export here
                });

                // Settings forms
                document.getElementById('generalSettingsForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    fetch('/api/settings', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            siteName: document.getElementById('siteName').value,
                            contactEmail: document.getElementById('contactEmail').value,
                            contactPhone: document.getElementById('contactPhone').value,
                            businessHours: document.getElementById('businessHours').value,
                            businessAddress: document.getElementById('businessAddress').value
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showAlert('Configuración general guardada', 'success');
                        } else {
                            showAlert(data.message || 'Error al guardar la configuración', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error saving settings:', error);
                        showAlert('Error al guardar la configuración', 'error');
                    });
                });

                document.getElementById('notificationSettingsForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    fetch('/api/settings/notification', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            template: document.getElementById('confirmedReservationTemplate').value
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showAlert('Plantilla de notificación guardada', 'success');
                        } else {
                            showAlert(data.message || 'Error al guardar la plantilla', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error saving notification template:', error);
                        showAlert('Error al guardar la plantilla', 'error');
                    });
                });

                // Notification recipients change
                document.getElementById('notificationRecipients').addEventListener('change', function() {
                    const value = this.value;
                    const specificUsersContainer = document.getElementById('specificUsersContainer');
                    specificUsersContainer.style.display = value === 'specific' ? 'block' : 'none';
                });

                // Add court form
                document.getElementById('saveCourtBtn').addEventListener('click', function() {
                    const form = document.getElementById('addCourtForm');
                    if (!form.checkValidity()) {
                        form.reportValidity();
                        return;
                    }
                    
                    const formData = new FormData();
                    formData.append('name', document.getElementById('courtName').value);
                    formData.append('type', document.getElementById('courtType').value);
                    formData.append('surface', document.getElementById('courtSurface').value);
                    formData.append('capacity', document.getElementById('courtCapacity').value);
                    formData.append('covered', document.getElementById('coveredCourt').checked);
                    formData.append('lighted', document.getElementById('lightedCourt').checked);
                    formData.append('status', document.getElementById('courtStatus').value);
                    formData.append('description', document.getElementById('courtDescription').value);
                    
                    // Add images
                    const imageFiles = document.getElementById('courtImages').files;
                    if (imageFiles) {
                        for (let i = 0; i < imageFiles.length; i++) {
                            formData.append('images', imageFiles[i]);
                        }
                    }
                    
                    fetch('/api/courts', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            loadCourts();
                            bootstrap.Modal.getInstance(document.getElementById('addCourtModal')).hide();
                            showAlert('Cancha agregada con éxito', 'success');
                            form.reset();
                            document.getElementById('newImagesPreview').innerHTML = '';
                        } else {
                            showAlert(data.message || 'Error al agregar la cancha', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error adding court:', error);
                        showAlert('Error al agregar la cancha', 'error');
                    });
                });

                // Edit court form
                document.getElementById('updateCourtBtn').addEventListener('click', function() {
                    const form = document.getElementById('editCourtForm');
                    if (!form.checkValidity()) {
                        form.reportValidity();
                        return;
                    }
                    
                    const courtId = document.getElementById('editCourtId').value;
                    const formData = new FormData();
                    formData.append('name', document.getElementById('editCourtName').value);
                    formData.append('type', document.getElementById('editCourtType').value);
                    formData.append('surface', document.getElementById('editCourtSurface').value);
                    formData.append('capacity', document.getElementById('editCourtCapacity').value);
                    formData.append('covered', document.getElementById('editCoveredCourt').checked);
                    formData.append('lighted', document.getElementById('editLightedCourt').checked);
                    formData.append('status', document.getElementById('editCourtStatus').value);
                    formData.append('description', document.getElementById('editCourtDescription').value);
                    
                    // Add new images
                    const imageFiles = document.getElementById('editCourtImages').files;
                    if (imageFiles) {
                        for (let i = 0; i < imageFiles.length; i++) {
                            formData.append('newImages', imageFiles[i]);
                        }
                    }
                    
                    fetch(`/api/courts/${courtId}`, {
                        method: 'PUT',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            loadCourts();
                            bootstrap.Modal.getInstance(document.getElementById('editCourtModal')).hide();
                            showAlert('Cancha actualizada con éxito', 'success');
                        } else {
                            showAlert(data.message || 'Error al actualizar la cancha', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error updating court:', error);
                        showAlert('Error al actualizar la cancha', 'error');
                    });
                });

                // Send notification
                document.getElementById('sendNotificationBtn').addEventListener('click', function() {
                    const form = document.getElementById('sendNotificationForm');
                    if (!form.checkValidity()) {
                        form.reportValidity();
                        return;
                    }
                    
                    const recipients = document.getElementById('notificationRecipients').value;
                    const specificUsers = recipients === 'specific' ? 
                        Array.from(document.getElementById('specificUsers').selectedOptions).map(o => parseInt(o.value)) : [];
                    
                    fetch('/api/notifications', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            title: document.getElementById('notificationTitle').value,
                            content: document.getElementById('notificationContent').value,
                            recipients: recipients,
                            specificUsers: specificUsers,
                            type: document.getElementById('notificationType').value
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            loadNotifications();
                            bootstrap.Modal.getInstance(document.getElementById('sendNotificationModal')).hide();
                            showAlert('Notificación enviada con éxito', 'success');
                            form.reset();
                        } else {
                            showAlert(data.message || 'Error al enviar la notificación', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error sending notification:', error);
                        showAlert('Error al enviar la notificación', 'error');
                    });
                });

                // Save user
                document.getElementById('saveUserBtn').addEventListener('click', function() {
                    const form = document.getElementById('userForm');
                    if (!form.checkValidity()) {
                        form.reportValidity();
                        return;
                    }
                    
                    const password = document.getElementById('userPassword').value;
                    const confirmPassword = document.getElementById('userConfirmPassword').value;
                    
                    if (password !== confirmPassword) {
                        showAlert('Las contraseñas no coinciden', 'error');
                        return;
                    }
                    
                    const userId = document.getElementById('userId').value;
                    const userData = {
                        name: document.getElementById('userFullName').value,
                        email: document.getElementById('userEmail').value,
                        phone: document.getElementById('userPhone').value,
                        status: document.getElementById('userStatus').value,
                        role: document.getElementById('userRole').value
                    };
                    
                    if (password) {
                        userData.password = password;
                    }
                    
                    const method = userId ? 'PUT' : 'POST';
                    const url = userId ? `/api/users/${userId}` : '/api/users';
                    
                    fetch(url, {
                        method: method,
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(userData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            loadUsers();
                            bootstrap.Modal.getInstance(document.getElementById('userModal')).hide();
                            showAlert(userId ? 'Usuario actualizado con éxito' : 'Usuario agregado con éxito', 'success');
                            form.reset();
                        } else {
                            showAlert(data.message || (userId ? 'Error al actualizar el usuario' : 'Error al agregar el usuario'), 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error saving user:', error);
                        showAlert(userId ? 'Error al actualizar el usuario' : 'Error al agregar el usuario', 'error');
                    });
                });

                // Save reservation
                document.getElementById('saveReservationBtn').addEventListener('click', function() {
                    const form = document.getElementById('reservationForm');
                    if (!form.checkValidity()) {
                        form.reportValidity();
                        return;
                    }
                    
                    const reservationId = document.getElementById('reservationId').value;
                    const reservationData = {
                        courtId: parseInt(document.getElementById('reservationCourt').value),
                        userId: parseInt(document.getElementById('reservationUser').value),
                        date: document.getElementById('reservationDate').value,
                        time: document.getElementById('reservationTime').value,
                        duration: parseFloat(document.getElementById('reservationDuration').value),
                        status: document.getElementById('reservationStatus').value,
                        notes: document.getElementById('reservationNotes').value
                    };
                    
                    const method = reservationId ? 'PUT' : 'POST';
                    const url = reservationId ? `/api/reservations/${reservationId}` : '/api/reservations';
                    
                    fetch(url, {
                        method: method,
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(reservationData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            loadReservations();
                            loadRecentReservations();
                            bootstrap.Modal.getInstance(document.getElementById('reservationModal')).hide();
                            showAlert(reservationId ? 'Reserva actualizada con éxito' : 'Reserva creada con éxito', 'success');
                            form.reset();
                        } else {
                            showAlert(data.message || (reservationId ? 'Error al actualizar la reserva' : 'Error al crear la reserva'), 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error saving reservation:', error);
                        showAlert(reservationId ? 'Error al actualizar la reserva' : 'Error al crear la reserva', 'error');
                    });
                });

                // Confirmation modal
                document.getElementById('confirmActionBtn').addEventListener('click', function() {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('confirmationModal'));
                    modal.hide();
                    
                    if (currentAction === 'deleteCourt') {
                        // Delete court
                        fetch(`/api/courts/${currentItemId}`, {
                            method: 'DELETE'
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                loadCourts();
                                showAlert('Cancha eliminada con éxito', 'success');
                            } else {
                                showAlert(data.message || 'Error al eliminar la cancha', 'error');
                            }
                        })
                        .catch(error => {
                            console.error('Error deleting court:', error);
                            showAlert('Error al eliminar la cancha', 'error');
                        });
                    } else if (currentAction === 'deleteNotification') {
                        // Delete notification
                        fetch(`/api/notifications/${currentItemId}`, {
                            method: 'DELETE'
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                loadNotifications();
                                showAlert('Notificación eliminada con éxito', 'success');
                            } else {
                                showAlert(data.message || 'Error al eliminar la notificación', 'error');
                            }
                        })
                        .catch(error => {
                            console.error('Error deleting notification:', error);
                            showAlert('Error al eliminar la notificación', 'error');
                        });
                    } else if (currentAction === 'blockUser') {
                        // Block user
                        fetch(`/api/users/${currentItemId}/block`, {
                            method: 'PUT'
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                loadUsers();
                                showAlert('Usuario bloqueado con éxito', 'success');
                            } else {
                                showAlert(data.message || 'Error al bloquear el usuario', 'error');
                            }
                        })
                        .catch(error => {
                            console.error('Error blocking user:', error);
                            showAlert('Error al bloquear el usuario', 'error');
                        });
                    } else if (currentAction === 'activateUser') {
                        // Activate user
                        fetch(`/api/users/${currentItemId}/activate`, {
                            method: 'PUT'
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                loadUsers();
                                showAlert('Usuario activado con éxito', 'success');
                            } else {
                                showAlert(data.message || 'Error al activar el usuario', 'error');
                            }
                        })
                        .catch(error => {
                            console.error('Error activating user:', error);
                            showAlert('Error al activar el usuario', 'error');
                        });
                    } else if (currentAction === 'confirmReservation') {
                        // Confirm reservation
                        fetch(`/api/reservations/${currentItemId}/confirm`, {
                            method: 'PUT'
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                loadReservations();
                                loadRecentReservations();
                                showAlert('Reserva confirmada con éxito', 'success');
                            } else {
                                showAlert(data.message || 'Error al confirmar la reserva', 'error');
                            }
                        })
                        .catch(error => {
                            console.error('Error confirming reservation:', error);
                            showAlert('Error al confirmar la reserva', 'error');
                        });
                    } else if (currentAction === 'cancelReservation') {
                        // Cancel reservation
                        fetch(`/api/reservations/${currentItemId}/cancel`, {
                            method: 'PUT'
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                loadReservations();
                                loadRecentReservations();
                                showAlert('Reserva cancelada con éxito', 'success');
                            } else {
                                showAlert(data.message || 'Error al cancelar la reserva', 'error');
                            }
                        })
                        .catch(error => {
                            console.error('Error canceling reservation:', error);
                            showAlert('Error al cancelar la reserva', 'error');
                        });
                    }
                    
                    currentAction = null;
                    currentItemId = null;
                });
            }

            // Handle reservation actions
            function handleReservationAction(action, id) {
                if (action === 'view') {
                    viewReservation(id);
                } else if (action === 'edit') {
                    editReservation(id);
                } else if (action === 'confirm') {
                    currentAction = 'confirmReservation';
                    currentItemId = id;
                    showConfirmationModal('Confirmar Reserva', '¿Está seguro que desea confirmar esta reserva?', null);
                } else if (action === 'cancel') {
                    currentAction = 'cancelReservation';
                    currentItemId = id;
                    showConfirmationModal('Cancelar Reserva', '¿Está seguro que desea cancelar esta reserva?', null);
                }
            }

            // Handle court actions
            function handleCourtAction(action, id) {
                if (action === 'edit') {
                    editCourt(id);
                } else if (action === 'delete') {
                    currentAction = 'deleteCourt';
                    currentItemId = id;
                    showConfirmationModal('Eliminar Cancha', '¿Está seguro que desea eliminar esta cancha?', null);
                }
            }

            // Handle user actions
            function handleUserAction(action, id) {
                if (action === 'edit') {
                    editUser(id);
                } else if (action === 'block') {
                    currentAction = 'blockUser';
                    currentItemId = id;
                    showConfirmationModal('Bloquear Usuario', '¿Está seguro que desea bloquear este usuario?', null);
                } else if (action === 'activate') {
                    currentAction = 'activateUser';
                    currentItemId = id;
                    showConfirmationModal('Activar Usuario', '¿Está seguro que desea activar este usuario?', null);
                }
            }

            // Handle notification actions
            function handleNotificationAction(action, id) {
                if (action === 'view') {
                    viewNotification(id);
                } else if (action === 'delete') {
                    currentAction = 'deleteNotification';
                    currentItemId = id;
                    showConfirmationModal('Eliminar Notificación', '¿Está seguro que desea eliminar esta notificación?', null);
                }
            }

            // View reservation details
            function viewReservation(id) {
                fetch(`/api/reservations/${id}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const reservation = data.reservation;
                            
                            document.getElementById('viewReservationId').textContent = `#${reservation.id}`;
                            document.getElementById('viewReservationCourt').textContent = reservation.court.name;
                            document.getElementById('viewReservationUser').textContent = reservation.user.name;
                            document.getElementById('viewReservationDateTime').textContent = `${formatDate(reservation.date)} ${reservation.time}`;
                            document.getElementById('viewReservationDuration').textContent = `${reservation.duration} horas`;
                            document.getElementById('viewReservationStatus').textContent = getStatusText(reservation.status);
                            document.getElementById('viewReservationNotes').textContent = reservation.notes || 'Ninguna';
                            
                            const modal = new bootstrap.Modal(document.getElementById('viewReservationModal'));
                            modal.show();
                        } else {
                            showAlert(data.message || 'Error al cargar la reserva', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error viewing reservation:', error);
                        showAlert('Error al cargar la reserva', 'error');
                    });
            }

            // Edit reservation
            function editReservation(id) {
                fetch(`/api/reservations/${id}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const reservation = data.reservation;
                            
                            // Fill court dropdown
                            const courtSelect = document.getElementById('reservationCourt');
                            courtSelect.innerHTML = '';
                            data.courts.forEach(court => {
                                const option = document.createElement('option');
                                option.value = court.id;
                                option.textContent = court.name;
                                option.selected = court.id === reservation.courtId;
                                courtSelect.appendChild(option);
                            });
                            
                            // Fill user dropdown
                            const userSelect = document.getElementById('reservationUser');
                            userSelect.innerHTML = '';
                            data.users.forEach(user => {
                                const option = document.createElement('option');
                                option.value = user.id;
                                option.textContent = user.name;
                                option.selected = user.id === reservation.userId;
                                userSelect.appendChild(option);
                            });
                            
                            // Fill other fields
                            document.getElementById('reservationId').value = reservation.id;
                            document.getElementById('reservationDate').value = reservation.date;
                            document.getElementById('reservationTime').value = reservation.time;
                            document.getElementById('reservationDuration').value = reservation.duration;
                            document.getElementById('reservationStatus').value = reservation.status;
                            document.getElementById('reservationNotes').value = reservation.notes || '';
                            
                            // Update modal title
                            document.getElementById('reservationModalTitle').textContent = 'Editar Reserva';
                            
                            const modal = new bootstrap.Modal(document.getElementById('reservationModal'));
                            modal.show();
                        } else {
                            showAlert(data.message || 'Error al cargar la reserva', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error loading reservation:', error);
                        showAlert('Error al cargar la reserva', 'error');
                    });
            }

            // Open new reservation modal
            function openReservationModal() {
                fetch('/api/reservations/form-data')
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Fill court dropdown
                            const courtSelect = document.getElementById('reservationCourt');
                            courtSelect.innerHTML = '';
                            data.courts.forEach(court => {
                                const option = document.createElement('option');
                                option.value = court.id;
                                option.textContent = court.name;
                                courtSelect.appendChild(option);
                            });
                            
                            // Fill user dropdown
                            const userSelect = document.getElementById('reservationUser');
                            userSelect.innerHTML = '';
                            data.users.forEach(user => {
                                const option = document.createElement('option');
                                option.value = user.id;
                                option.textContent = user.name;
                                userSelect.appendChild(option);
                            });
                            
                            // Clear other fields
                            document.getElementById('reservationId').value = '';
                            document.getElementById('reservationDate').value = '';
                            document.getElementById('reservationTime').value = '';
                            document.getElementById('reservationDuration').value = '1';
                            document.getElementById('reservationStatus').value = 'pending';
                            document.getElementById('reservationNotes').value = '';
                            
                            // Update modal title
                            document.getElementById('reservationModalTitle').textContent = 'Nueva Reserva';
                            
                            const modal = new bootstrap.Modal(document.getElementById('reservationModal'));
                            modal.show();
                        } else {
                            showAlert(data.message || 'Error al cargar datos del formulario', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error loading form data:', error);
                        showAlert('Error al cargar datos del formulario', 'error');
                    });
            }

            // Edit court
            function editCourt(id) {
                fetch(`/api/courts/${id}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const court = data.court;
                            
                            document.getElementById('editCourtId').value = court.id;
                            document.getElementById('editCourtName').value = court.name;
                            document.getElementById('editCourtType').value = court.type;
                            document.getElementById('editCourtSurface').value = court.surface;
                            document.getElementById('editCourtCapacity').value = court.capacity;
                            document.getElementById('editCoveredCourt').checked = court.covered;
                            document.getElementById('editLightedCourt').checked = court.lighted;
                            document.getElementById('editCourtStatus').value = court.status;
                            document.getElementById('editCourtDescription').value = court.description;
                            
                            // Mostrar imágenes existentes
                            const currentImagesContainer = document.getElementById('currentImages');
                            currentImagesContainer.innerHTML = '';
                            
                            if (court.images && court.images.length > 0) {
                                court.images.forEach((image, index) => {
                                    const imgContainer = document.createElement('div');
                                    imgContainer.className = 'position-relative';
                                    imgContainer.style.width = '100px';
                                    
                                    const img = document.createElement('img');
                                    img.src = image.url;
                                    img.className = 'img-thumbnail';
                                    img.style.width = '100%';
                                    img.style.height = '100px';
                                    img.style.objectFit = 'cover';
                                    
                                    const removeBtn = document.createElement('button');
                                    removeBtn.className = 'btn btn-danger btn-sm position-absolute top-0 end-0';
                                    removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                                    removeBtn.onclick = function() {
                                        // Eliminar la imagen
                                        fetch(`/api/courts/${court.id}/images/${image.id}`, {
                                            method: 'DELETE'
                                        })
                                        .then(response => response.json())
                                        .then(data => {
                                            if (data.success) {
                                                imgContainer.remove();
                                            } else {
                                                showAlert(data.message || 'Error al eliminar la imagen', 'error');
                                            }
                                        })
                                        .catch(error => {
                                            console.error('Error deleting image:', error);
                                            showAlert('Error al eliminar la imagen', 'error');
                                        });
                                    };
                                    
                                    imgContainer.appendChild(img);
                                    imgContainer.appendChild(removeBtn);
                                    currentImagesContainer.appendChild(imgContainer);
                                });
                            }
                            
                            const modal = new bootstrap.Modal(document.getElementById('editCourtModal'));
                            modal.show();
                        } else {
                            showAlert(data.message || 'Error al cargar la cancha', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error loading court:', error);
                        showAlert('Error al cargar la cancha', 'error');
                    });
            }

            // View notification
            function viewNotification(id) {
                fetch(`/api/notifications/${id}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const notification = data.notification;
                            
                            document.getElementById('viewNotificationTitle').textContent = notification.title;
                            document.getElementById('viewNotificationContent').textContent = notification.content;
                            document.getElementById('viewNotificationRecipients').textContent = getRecipientsText(notification.recipients);
                            document.getElementById('viewNotificationDate').textContent = formatDate(notification.date);
                            document.getElementById('viewNotificationStatus').textContent = 'Enviada';
                            
                            const modal = new bootstrap.Modal(document.getElementById('viewNotificationModal'));
                            modal.show();
                        } else {
                            showAlert(data.message || 'Error al cargar la notificación', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error viewing notification:', error);
                        showAlert('Error al cargar la notificación', 'error');
                    });
            }

            // Edit user
            function editUser(id) {
                fetch(`/api/users/${id}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const user = data.user;
                            
                            document.getElementById('userId').value = user.id;
                            document.getElementById('userFullName').value = user.name;
                            document.getElementById('userEmail').value = user.email;
                            document.getElementById('userPhone').value = user.phone;
                            document.getElementById('userPassword').value = '';
                            document.getElementById('userConfirmPassword').value = '';
                            document.getElementById('userRole').value = user.role;
                            document.getElementById('userStatus').value = user.status;
                            
                            // Update modal title
                            document.getElementById('userModalTitle').textContent = 'Editar Usuario';
                            
                            const modal = new bootstrap.Modal(document.getElementById('userModal'));
                            modal.show();
                        } else {
                            showAlert(data.message || 'Error al cargar el usuario', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error loading user:', error);
                        showAlert('Error al cargar el usuario', 'error');
                    });
            }

            // Open new user modal
            function openUserModal() {
                // Clear fields
                document.getElementById('userId').value = '';
                document.getElementById('userFullName').value = '';
                document.getElementById('userEmail').value = '';
                document.getElementById('userPhone').value = '';
                document.getElementById('userPassword').value = '';
                document.getElementById('userConfirmPassword').value = '';
                document.getElementById('userRole').value = 'user';
                document.getElementById('userStatus').value = 'active';
                
                // Update modal title
                document.getElementById('userModalTitle').textContent = 'Agregar Usuario';
                
                const modal = new bootstrap.Modal(document.getElementById('userModal'));
                modal.show();
            }

            // Show confirmation modal
            function showConfirmationModal(title, message, callback) {
                document.getElementById('confirmationModalTitle').textContent = title;
                document.getElementById('confirmationModalBody').textContent = message;
                
                const modal = new bootstrap.Modal(document.getElementById('confirmationModal'));
                modal.show();
                
                if (callback) {
                    document.getElementById('confirmActionBtn').onclick = callback;
                }
            }

            // Show alert message
            function showAlert(message, type) {
                const alertContainer = document.querySelector('.alert-container');
                const alert = document.createElement('div');
                alert.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show`;
                alert.role = 'alert';
                alert.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                `;
                
                alertContainer.appendChild(alert);
                
                // Auto dismiss after 5 seconds
                setTimeout(() => {
                    alert.classList.remove('show');
                    setTimeout(() => {
                        alert.remove();
                    }, 150);
                }, 5000);
            }

            // Helper function to validate email
            function validarEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }

            // Helper function to format date
            function formatDate(dateString) {
                const options = { day: 'numeric', month: 'short', year: 'numeric' };
                const date = new Date(dateString);
                return date.toLocaleDateString('es-ES', options);
            }

            // Helper function to get status text
            function getStatusText(status) {
                const statusMap = {
                    'pending': 'Pendiente',
                    'confirmed': 'Confirmada',
                    'cancelled': 'Cancelada',
                    'completed': 'Completada',
                    'active': 'Activa',
                    'maintenance': 'En Mantenimiento',
                    'inactive': 'Inactiva'
                };
                return statusMap[status] || status;
            }

            // Helper function to get status badge class
            function getStatusBadgeClass(status) {
                const classMap = {
                    'pending': 'bg-warning',
                    'confirmed': 'bg-success',
                    'cancelled': 'bg-danger',
                    'completed': 'bg-secondary',
                    'active': 'bg-success',
                    'maintenance': 'bg-warning',
                    'inactive': 'bg-secondary'
                };
                return classMap[status] || 'bg-secondary';
            }

            // Helper function to get status color
            function getStatusColor(status) {
                const colorMap = {
                    'pending': '#f39c12',
                    'confirmed': '#2ecc71',
                    'cancelled': '#e74c3c',
                    'completed': '#7f8c8d',
                    'active': '#2ecc71',
                    'maintenance': '#f39c12',
                    'inactive': '#7f8c8d'
                };
                return colorMap[status] || '#7f8c8d';
            }

            // Helper function to get court type text
            function getCourtTypeText(type) {
                const typeMap = {
                    'futbol11': 'Fútbol 11',
                    'futbol5': 'Fútbol 5',
                    'tenis': 'Tenis',
                    'basquetbol': 'Básquetbol',
                    'voleibol': 'Vóleibol',
                    'padel': 'Pádel',
                    'otro': 'Otro'
                };
                return typeMap[type] || type;
            }

            // Helper function to get surface text
            function getSurfaceText(surface) {
                const surfaceMap = {
                    'cesped-sintetico': 'Césped sintético',
                    'arcilla': 'Arcilla',
                    'concreto': 'Concreto pulido',
                    'arena': 'Arena',
                    'cesped-natural': 'Césped natural',
                    'cesped-artificial': 'Césped artificial',
                    'otro': 'Otro'
                };
                return surfaceMap[surface] || surface;
            }

            // Helper function to get recipients text
            function getRecipientsText(recipients) {
                const recipientsMap = {
                    'all': 'Todos los usuarios',
                    'active': 'Usuarios activos',
                    'with-reservations': 'Usuarios con reservas',
                    'specific': 'Usuarios específicos'
                };
                return recipientsMap[recipients] || recipients;
            }

            // Initialize the application
            initApp();
        });
    </script>
</body>
</html>